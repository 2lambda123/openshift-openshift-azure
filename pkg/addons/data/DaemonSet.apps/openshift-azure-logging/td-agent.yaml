apiVersion: apps/v1
kind: DaemonSet
metadata:
  labels:
    app: td-agent
  name: td-agent
  namespace: openshift-azure-logging
spec:
  selector:
    matchLabels:
      app: td-agent-ds
  template:
    metadata:
      annotations:
        scheduler.alpha.kubernetes.io/critical-pod: ""
      labels:
        app: td-agent-ds
    spec:
      containers:
      - env:
        - name: FLUENTD_CONF
          value: config/fluent.conf
        image: '*** GENERATED ***'
        livenessProbe:
          exec:
            command:
            - /bin/bash
            - /td-agent/liveness-probe.sh
          failureThreshold: 5
          initialDelaySeconds: 60
          periodSeconds: 60
        name: td-agent
        ports:
        - containerPort: 9102
        resources:
          limits:
            cpu: 400m
            memory: 800Mi
          requests:
            cpu: 200m
            memory: 200Mi
        securityContext:
          privileged: true
          runAsUser: 0
        volumeMounts:
        - mountPath: /var/run/mdsdcustomerdata/
          name: customerdata-mdsd-sockets
          readOnly: true
        - mountPath: /td-agent/config
          name: fluentd-config
        - mountPath: /var/log
          name: hostlog
      hostPID: true
      imagePullSecrets:
      - name: azure-registry
      serviceAccountName: geneva
      tolerations:
      - effect: NoExecute
        operator: Exists
      - effect: NoSchedule
        operator: Exists
      volumes:
      - hostPath:
          path: /var/run/customerDataMdsdContainer/
        name: customerdata-mdsd-sockets
      - hostPath:
          path: /var/log
        name: hostlog
      - configMap:
          items:
          - key: fluent.conf
            path: fluent.conf
          name: fluentd-config
        name: fluentd-config
