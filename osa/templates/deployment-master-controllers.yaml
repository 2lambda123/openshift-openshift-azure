apiVersion: apps/v1
kind: Deployment
metadata:
  name: master-controllers
spec:
  replicas: 1
  selector:
    matchLabels:
      openshift.io/component: controllers
  template:
    metadata:
      labels:
        openshift.io/component: controllers
    spec:
      containers:
      - name: controllers
        # TODO: all images need to be parameterised
        image: docker.io/openshift/origin-control-plane:v3.10
        command:
        - /bin/bash
        - -c
        args:
        - |
          set -euo pipefail
          if [[ -f /etc/origin/master/master.env ]]; then
            set -o allexport
            source /etc/origin/master/master.env
          fi
          exec openshift start master controllers --config=/etc/origin/master/master-config.yaml --listen=https://0.0.0.0:8444 --loglevel=${DEBUG_LOGLEVEL:-2}
        env:
        - name: DEBUG_LOGLEVEL
          value: "4"
        livenessProbe:
          httpGet:
            path: healthz
            port: 8444
            scheme: HTTPS
        volumeMounts:
        - name: master-config
          mountPath: /etc/origin/master/
          readOnly: true
        - name: master-cloud-provider
          mountPath: /etc/origin/cloudprovider/
          readOnly: true
      volumes:
      - name: master-config
        secret:
          secretName: etc-origin-master
      - name: master-cloud-provider
        secret:
          secretName: etc-origin-cloudprovider
